<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª≠i Qu·ª≥nh Nh∆∞ üíï</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; /* ·∫®n thanh cu·ªôn */
        }

        /* Container ch·ª©a ·∫£nh n·ªÅn 360 */
        #panorama-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* N·∫±m d∆∞·ªõi c√πng */
        }

        /* Container ch√≠nh ch·ª©a form c√¢u h·ªèi */
        #main-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10; /* N·∫±m n·ªïi l√™n tr√™n n·ªÅn 360 */
            
            background: rgba(255, 255, 255, 0.85); /* N·ªÅn tr·∫Øng b√°n trong su·ªët */
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 420px;
            text-align: center;
            backdrop-filter: blur(5px); /* Hi·ªáu ·ª©ng m·ªù k√≠nh ph√≠a sau */
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* ƒê√£ x√≥a ·∫£nh Hello Kitty */

        h2, h3 { color: #d63384; margin: 15px 0; font-size: 18px; }
        
        .question-box { margin-bottom: 20px; text-align: left; }
        
        label { display: block; margin: 8px 0; color: #333; cursor: pointer; font-weight: 500; }
        
        textarea {
            width: 100%;
            height: 90px;
            border: 2px solid #ffb6c1;
            border-radius: 12px;
            padding: 10px;
            box-sizing: border-box;
            font-family: inherit;
            resize: none;
        }

        button#btnSubmit {
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 15px;
        }

        button#btnSubmit:hover { transform: scale(1.03); box-shadow: 0 5px 15px rgba(255, 20, 147, 0.4); }

        /* N√∫t b·∫≠t nh·∫°c */
        #music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 20;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #d63384;
            transition: all 0.3s;
        }
        #music-control:hover { background: white; transform: scale(1.05); }
        #music-control span { margin-left: 5px; }

        /* ·∫®n input radio m·∫∑c ƒë·ªãnh */
        input[type="radio"] { accent-color: #ff1493; transform: scale(1.2); margin-right: 8px; }

        /* Hi·ªáu ·ª©ng sau khi g·ª≠i (gi·ªØ nguy√™n) */
        #animation-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: black; display: none; z-index: 100; overflow: hidden;
        }
        .falling-text {
            position: absolute; color: #ff69b4; font-weight: bold; font-size: 18px;
            user-select: none; white-space: nowrap; animation: fall linear infinite;
        }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes fall { 0% { transform: translateY(-100px); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(110vh); opacity: 0; } }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="nhacnen.mp3" type="audio/mpeg">
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t nh·∫°c.
    </audio>

    <div id="music-control" onclick="toggleMusic()">
        üéµ <span>B·∫≠t nh·∫°c "N∆°i n√†y c√≥ anh"</span>
    </div>

    <div id="panorama-container"></div>

    <div id="main-container">
        <form id="loveForm" action="https://formspree.io/f/YOUR_FORMSPREE_ID" method="POST">
            
            <div class="question-box">
                <h3>M·∫•y b·ªØa nay Qu·ª≥nh Nh∆∞ c·∫£m th·∫•y tui nh∆∞ th·∫ø n√†o? ü§î</h3>
                <label><input type="radio" name="Cam_nghi" value="T·ªët" required> A. T·ªët üòá</label>
                <label><input type="radio" name="Cam_nghi" value="Kh√¥ng T·ªët"> B. Kh√¥ng T·ªët ü•∫</label>
                <label><input type="radio" name="Cam_nghi" value="B√¨nh th∆∞·ªùng"> C. B√¨nh th∆∞·ªùng üòê</label>
            </div>

            <div class="question-box">
                <h3>C·∫ßn tui thay ƒë·ªïi g√¨ ƒë·ªÉ Gi√°ng sinh n√†y tui c√≥ ny hong? üéÑ</h3>
                <textarea name="Loi_khuyen" placeholder="Vi·∫øt ng·∫Øn g·ªçn kho·∫£ng 200 ch·ªØ thui nha..." required></textarea>
            </div>

            <button type="submit" id="btnSubmit">G·ª≠i cho tui ƒëi üíï</button>
        </form>
    </div>

    <div id="animation-layer"></div>

    <script>
        // 1. C·∫•u h√¨nh ·∫£nh 360 ƒë·ªô (D√πng ·∫£nh m·∫´u c·∫£nh ƒë·∫πp l√£ng m·∫°n)
        pannellum.viewer('panorama-container', {
            "type": "equirectangular",
            // ƒê√¢y l√† link ·∫£nh 360 ƒë·ªô m·∫´u. B·∫°n c√≥ th·ªÉ t√¨m ·∫£nh kh√°c tr√™n m·∫°ng v√† thay link v√†o ƒë√¢y.
            "panorama": "https://i.imgur.com/U2t7zK3.jpeg", 
            "autoLoad": true,
            "autoRotate": -2, // T·ª± ƒë·ªông xoay ch·∫≠m
            "compass": false,
            "showControls": false // ·∫®n c√°c n√∫t ƒëi·ªÅu khi·ªÉn ƒë·ªÉ nh√¨n cho th·∫≠t
        });

        // 2. X·ª≠ l√Ω b·∫≠t/t·∫Øt nh·∫°c
        const bgMusic = document.getElementById('bgMusic');
        const musicControl = document.getElementById('music-control');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicControl.innerHTML = 'üéµ <span>B·∫≠t nh·∫°c</span>';
                isMusicPlaying = false;
            } else {
                // C·ªë g·∫Øng ph√°t nh·∫°c
                bgMusic.play().then(() => {
                    musicControl.innerHTML = 'üîá <span>T·∫Øt nh·∫°c</span>';
                    isMusicPlaying = true;
                    // ·∫®n n√∫t sau 3 gi√¢y cho ƒë·ª° v∆∞·ªõng
                    setTimeout(() => { musicControl.style.opacity = '0.5'; }, 3000);
                }).catch(error => {
                    console.log("Kh√¥ng th·ªÉ ph√°t nh·∫°c t·ª± ƒë·ªông do ch√≠nh s√°ch tr√¨nh duy·ªát.");
                    alert("B·∫°n h√£y ch·∫°m v√†o m√†n h√¨nh m·ªôt l·∫ßn n·ªØa ƒë·ªÉ nh·∫°c b·∫Øt ƒë·∫ßu ph√°t nh√©!");
                });
            }
        }
        
        // --- Ph·∫ßn x·ª≠ l√Ω g·ª≠i form v√† hi·ªáu ·ª©ng ch·ªØ r∆°i (Gi·ªØ nguy√™n nh∆∞ c≈©) ---
        const form = document.getElementById('loveForm');
        const mainContainer = document.getElementById('main-container');
        const animationLayer = document.getElementById('animation-layer');
        const words = ["yeu qnhuüíï", "mot c√¥ g√°i d·ªÖ th∆∞∆°ngüòò", "m√£i yeuüíû", "ch√∫c ng√†y 3/12 vui v·∫ªü•∞", "s·ªõm qlaii voi tui üòª", "nh·ªõ em nhi·ªÅu üíñ", "xinh ƒë·∫πp tuy·ªát v·ªùi üåπ", "c√¥ng ch√∫a c·ªßa tui üëë"];

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            fetch(form.action, { method: form.method, body: formData, headers: {'Accept': 'application/json'} })
            .then(response => { startAnimation(); }).catch(error => { startAnimation(); });
        });

        function startAnimation() {
            mainContainer.style.display = 'none';
            animationLayer.style.display = 'block';
            document.body.style.backgroundColor = 'black';
            document.getElementById('panorama-container').style.display = 'none'; // ·∫®n n·ªÅn 360
            musicControl.style.display = 'none'; // ·∫®n n√∫t nh·∫°c

            for(let i=0; i<50; i++) { createStar(); }
            setInterval(createFallingText, 300);
        }

        function createStar() {
            const star = document.createElement('div'); star.classList.add('star');
            const size = Math.random() * 3;
            star.style.width = size + 'px'; star.style.height = size + 'px';
            star.style.left = Math.random() * 100 + 'vw'; star.style.top = Math.random() * 100 + 'vh';
            animationLayer.appendChild(star);
        }

        function createFallingText() {
            const text = document.createElement('div'); text.classList.add('falling-text');
            text.innerText = words[Math.floor(Math.random() * words.length)];
            text.style.left = Math.random() * 90 + 'vw'; 
            text.style.animationDuration = (Math.random() * 5 + 3) + 's'; 
            text.style.fontSize = (Math.random() * 10 + 16) + 'px';
            animationLayer.appendChild(text);
            setTimeout(() => { text.remove(); }, 8000);
        }
    </script>
</body>
</html>