<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª≠i Qu·ª≥nh Nh∆∞ üíï</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background-color: #000;
        }

        /* Khung nh√¨n 360 ƒë·ªô */
        #panorama {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Hi·ªáu ·ª©ng Sao bƒÉng (Shooting Stars) */
        .meteor {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 2px;
            background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
            animation: meteor-fall 3s linear infinite;
            transform: rotate(-45deg);
            pointer-events: none; /* ƒê·ªÉ kh√¥ng che m·∫•t chu·ªôt khi xoay h√¨nh */
            z-index: 2; /* N·∫±m tr√™n n·ªÅn 360 nh∆∞ng d∆∞·ªõi form */
            opacity: 0;
        }

        @keyframes meteor-fall {
            0% { transform: translate(-50vh, -50vh) rotate(-45deg); opacity: 1; }
            100% { transform: translate(50vh, 50vh) rotate(-45deg); opacity: 0; }
        }

        /* Form k√≠nh m·ªù (Glassmorphism) */
        #card-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            padding: 30px;
            border-radius: 20px;
            background: rgba(255, 192, 203, 0.15); /* H·ªìng c·ª±c nh·∫°t trong su·ªët */
            backdrop-filter: blur(10px); /* L√†m m·ªù h·∫≠u c·∫£nh sau l∆∞ng form */
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
            z-index: 10;
            text-align: center;
            color: white;
        }

        /* Ch·ªØ 3D n·ªïi kh·ªëi */
        h2, h3 {
            font-size: 20px;
            color: #fff;
            text-shadow: 
                0 1px 0 #ff69b4, 
                0 2px 0 #ff69b4, 
                0 3px 0 #ff69b4, 
                0 4px 10px rgba(0,0,0,0.5); /* T·∫°o b√≥ng ƒë·ªï 3D */
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-box { margin-bottom: 20px; text-align: left; }

        label {
            display: block;
            margin: 10px 0;
            cursor: pointer;
            font-size: 16px;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        textarea {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            border: none;
            padding: 10px;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.8);
        }

        button#btnSubmit {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff1493, #ff69b4);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 20, 147, 0.5);
            transition: transform 0.2s;
        }
        button#btnSubmit:hover { transform: scale(1.05); }

        /* N√∫t nh·∫°c */
        #music-btn {
            position: fixed;
            top: 20px; right: 20px; z-index: 100;
            background: rgba(255,255,255,0.2);
            color: white; border: 1px solid white;
            padding: 10px 20px; border-radius: 30px;
            cursor: pointer; backdrop-filter: blur(5px);
        }

        /* Hi·ªáu ·ª©ng sau khi g·ª≠i */
        #animation-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 200; display: none; overflow: hidden;
        }
        .falling-word {
            position: absolute;
            color: #ff69b4;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 0 0 10px #ff1493;
            animation: fall linear infinite;
            white-space: nowrap;
        }
        @keyframes fall { to { transform: translateY(110vh); } }

    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="nhacnen.mp3" type="audio/mpeg">
    </audio>
    <button id="music-btn" onclick="toggleMusic()">üéµ B·∫≠t nh·∫°c "N∆°i n√†y c√≥ anh"</button>

    <div id="panorama"></div>

    <div id="meteors"></div>

    <div id="card-container">
        <form id="loveForm" action="https://formspree.io/f/YOUR_FORMSPREE_ID" method="POST">
            <h3>M·∫•y b·ªØa nay Qu·ª≥nh Nh∆∞ c·∫£m th·∫•y tui nh∆∞ th·∫ø n√†o? ü§î</h3>
            <div class="question-box">
                <label><input type="radio" name="Cam_nghi" value="T·ªët" required> A. T·ªët l·∫Øm ü•∞</label>
                <label><input type="radio" name="Cam_nghi" value="Kh√¥ng T·ªët"> B. Hong T·ªët ü•∫</label>
                <label><input type="radio" name="Cam_nghi" value="B√¨nh th∆∞·ªùng"> C. B√¨nh th∆∞·ªùng üòê</label>
            </div>

            <h3>C·∫ßn tui thay ƒë·ªïi g√¨ ƒë·ªÉ Gi√°ng sinh n√†y tui c√≥ ny hong? üéÑ</h3>
            <div class="question-box">
                <textarea name="Loi_khuyen" placeholder="Vi·∫øt g√¨ ƒë√≥ ƒëi m√†..." required></textarea>
            </div>

            <button type="submit" id="btnSubmit">G·ª≠i cho tui ƒëi üíï</button>
        </form>
    </div>

    <div id="animation-overlay"></div>

    <script>
        // --- C·∫§U H√åNH 360 ƒê·ªò ---
        pannellum.viewer('panorama', {
            "type": "equirectangular",
            "panorama": "https://i.imgur.com/8F9Yx7L.jpg", // ·∫¢nh b·∫ßu tr·ªùi ƒë√™m ƒë·∫ßy sao c·ª±c ƒë·∫πp
            "autoLoad": true,
            "autoRotate": -2, // T·ª± ƒë·ªông xoay nh·∫π
            "showControls": false // ·∫®n n√∫t ƒëi·ªÅu khi·ªÉn cho th·∫≠t
        });

        // --- T·∫†O SAO BƒÇNG ---
        const meteorContainer = document.getElementById('meteors');
        function createMeteors() {
            setInterval(() => {
                const meteor = document.createElement('div');
                meteor.classList.add('meteor');
                meteor.style.left = Math.random() * 100 + 'vw';
                meteor.style.top = Math.random() * 50 + 'vh';
                meteor.style.animationDuration = (Math.random() * 1 + 0.5) + 's'; // T·ªëc ƒë·ªô ng·∫´u nhi√™n
                meteorContainer.appendChild(meteor);
                
                // X√≥a sao bƒÉng sau khi bay xong
                setTimeout(() => { meteor.remove(); }, 2000);
            }, 800); // 0.8 gi√¢y xu·∫•t hi·ªán 1 sao bƒÉng
        }
        createMeteors();

        // --- X·ª¨ L√ù NH·∫†C ---
        const audio = document.getElementById('bgMusic');
        const btn = document.getElementById('music-btn');
        let playing = false;
        function toggleMusic() {
            if(!playing) {
                audio.play().then(() => {
                    playing = true;
                    btn.innerText = "üîà T·∫Øt nh·∫°c";
                    btn.style.opacity = "0.5";
                }).catch(e => alert("H√£y ch·∫°m v√†o m√†n h√¨nh l·∫ßn n·ªØa ƒë·ªÉ nh·∫°c ch·∫°y nh√©!"));
            } else {
                audio.pause();
                playing = false;
                btn.innerText = "üéµ B·∫≠t nh·∫°c";
                btn.style.opacity = "1";
            }
        }

        // --- X·ª¨ L√ù G·ª¨I FORM & CH·ªÆ R∆†I ---
        const form = document.getElementById('loveForm');
        const overlay = document.getElementById('animation-overlay');
        const words = ["Y√™u Q.Nh∆∞ üíï", "D·ªÖ th∆∞∆°ng x·ªâu üòò", "M√£i y√™u üíû", "Gi√°ng sinh vui v·∫ª üéÑ", "S·ªõm quay l·∫°i v·ªõi tui üòª", "Miss you ‚ù§Ô∏è"];

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            // G·ª≠i d·ªØ li·ªáu ƒëi (gi·∫£ l·∫≠p ho·∫∑c g·ª≠i th·∫≠t)
            const formData = new FormData(form);
            fetch(form.action, { method: form.method, body: formData, headers: {'Accept': 'application/json'} })
            .then(() => runEffect()).catch(() => runEffect());
        });

        function runEffect() {
            document.getElementById('card-container').style.display = 'none';
            document.getElementById('music-btn').style.display = 'none';
            document.getElementById('panorama').style.display = 'none'; // T·∫Øt n·ªÅn 360 cho t·ªëi h·∫≥n
            overlay.style.display = 'block';

            // T·∫°o hi·ªáu ·ª©ng ch·ªØ r∆°i
            setInterval(() => {
                const div = document.createElement('div');
                div.classList.add('falling-word');
                div.innerText = words[Math.floor(Math.random() * words.length)];
                div.style.left = Math.random() * 90 + 'vw';
                div.style.animationDuration = (Math.random() * 3 + 2) + 's';
                div.style.color = `hsl(${Math.random()*60 + 300}, 100%, 70%)`; // C√°c t√¥ng m√†u h·ªìng/t√≠m
                div.style.fontSize = (Math.random() * 20 + 20) + 'px';
                overlay.appendChild(div);
                setTimeout(() => div.remove(), 6000);
            }, 300);
        }
    </script>
</body>
</html>
